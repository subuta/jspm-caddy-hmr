!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],b):b(a.jspmCaddy=a.jspmCaddy||{},a.lodash)}(this,function(a,b){"use strict";b="default"in b?b["default"]:b;var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,d=function(a){return c.exec(a).slice(1)},e=function(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c},f=function(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a},g=function(){for(var a="",b=!1,c=arguments.length-1;c>=-1&&!b;c--){var d=c>=0?arguments[c]:"/";if("string"!=typeof d)throw new TypeError("Arguments to path.resolve must be strings");d&&(a=d+"/"+a,b="/"===d.charAt(0))}return a=f(e(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},h=function(a){var b=d(a),c=b[0],e=b[1];return c||e?(e&&(e=e.substr(0,e.length-1)),c+e):"."},i=window.System,j=[],k=function(a){var c=b.first(b.keys(i.bundles)),d=i.bundles[c],e=a===c||b.startsWith(a,c),f=q(a),g=b.includes(d,f),h=void 0;if(g){var k=m(f);b.each(k,function(a,b){o(b),j.push(b)});var l=b.pullAll(n(f),j);b.each(l,function(a){return o(a)}),b.last(l)&&j.push(b.last(l)),h=Promise.resolve()}else h=r(f);if(e){var s=b.map(j,function(a){return console.debug(a," re-imported."),p(a)});h=Promise.all(s),j=[]}return h},l=function(a){return b.startsWith(a,location.origin+"/jspm_packages")},m=function(a){var c=b.reject(b.keys(i.loads),l);return b.reduce(c,function(c,d){var e=i.loads[d].deps,f=b.some(e,function(b){return q(b,d)===a});return(a===d||f)&&(c[d]=b.map(e,function(a){return q(a,d)})),c},{})},n=function u(a){var c=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],d=m(a),e=b.findKey(d,function(c){return b.some(c,function(b){return b===a})});return e?(c.push(e),u(e,c)):c},o=function(a){if(a&&i.has(a)){var b=i.get(a);return b._unload&&b._unload(),i["delete"](a)}throw new Error("Failed to delete. because file("+a+") not imported yet.")},p=function(a){return i["import"](a).then(function(a){return a._reload&&a._reload(),a})},q=function(a,c){var d=i.normalizeSync(a),e=d;if(l(d))return d;if(c&&b.endsWith(a,".js")){var f=d.replace(location.origin,"");if(c=c.replace(location.origin,""),b.endsWith(c,".js")&&(c=h(c)),b.startsWith(a,".")){var j=g(c,"."+f);e=""+location.origin+j}else e=""+location.origin+f}return b.endsWith(e,".js")||(e+=".js"),e},r=function(a){return o(a),p(a)},s=!1;console.debug=s?console.debug:b.noop;var t=function(a,c){var d,e=b.trimStart(a,"/");d=c?new WebSocket("ws://"+location.hostname+":"+c+"/"+e):new WebSocket("ws://"+location.host+"/"+e),d.onopen=function(a){console.debug("[watcher] websocket connection opened")},d.onmessage=function(a){if(b.startsWith(a.data,"data: ")){var c=b.trimStart(a.data,"data: ");k(b.endsWith(c,".js")?c:c+"!")}else console.debug(a.data,"data: ")},d.onclose=function(){console.debug("[watcher] websocket connection closed.")}};a["default"]=t,Object.defineProperty(a,"__esModule",{value:!0})});