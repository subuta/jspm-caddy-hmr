!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("lodash/lodash.js")):"function"==typeof define&&define.amd?define(["exports","lodash/lodash.js"],b):b(a.jspmCaddy=a.jspmCaddy||{},a._)}(this,function(a,b){"use strict";b="default"in b?b["default"]:b;var c=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)},g=function(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c},h=function(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a},i=function(){for(var a="",b=!1,c=arguments.length-1;c>=-1&&!b;c--){var d=c>=0?arguments[c]:"/";if("string"!=typeof d)throw new TypeError("Arguments to path.resolve must be strings");d&&(a=d+"/"+a,b="/"===d.charAt(0))}return a=h(g(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},j=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},k=window.System,l=!1,m=[],n=function(a){b.endsWith(a,".js")||(a+="!");var c=b.first(b.keys(k.bundles)),d=k.bundles[c],e=a===c||b.startsWith(a,c),f=t(a),g=b.includes(d,f),h=void 0;if(g){var i=p(f);b.each(i,function(a,b){r(b),m.push(b)});var j=b.pullAll(q(f),m);b.each(j,function(a){return r(a)}),b.last(j)&&m.push(b.first(j)),h=Promise.resolve()}else h=u(f);if(e){var l=b.map(m,function(a){return console.debug(a," re-imported."),s(a)});h=Promise.all(l),m=[]}return h},o=function(a){return b.startsWith(a,location.origin+"/jspm_packages")},p=function(a){var c=b.reject(b.keys(k.loads),o);return b.reduce(c,function(c,d){var e=k.loads[d].deps,f=b.some(e,function(b){return t(b,d)===a});return(a===d||f)&&(c[d]=b.map(e,function(a){return t(a,d)})),c},{})},q=function x(a){var c=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],e=p(a),f=b.reduce(e,function(c,d,e){return b.some(d,function(b){return b===a})&&c.push(e),c},[]);if(b.isEmpty(f))return b.reverse(c);if(1===f.length){var g=f[0];return x(g,[].concat(d(c),[g]))}if(f.length>1){var h=b.map(f,function(a){return x(a,[].concat(d(c),[a]))});return b.uniq(b.flattenDeep(h))}},r=function(a){if(a&&k.has(a)){var b=k.get(a);return b._unload&&b._unload(),k["delete"](a)}if(l)throw new Error("Failed to delete. because file("+a+") not imported yet.");console.debug("Failed to delete. because file("+a+") not imported yet.")},s=function(a){return k["import"](a).then(function(a){return a._reload&&a._reload(),a},function(b){if(l)throw b;console.warn("Failed to import file:("+a+"), error = ",b)})},t=function(a,c){var d=k.normalizeSync(a);if(k.has(d))return d;if(o(d))return d;var e=d;if(c&&b.endsWith(a,".js"))if(c=c.replace(location.origin,""),b.endsWith(c,".js")&&(c=j(c)),b.startsWith(a,".")){var f=i(c,a);e=""+location.origin+f}else e=""+location.origin+i(a);return b.endsWith(e,".js")||(e+=".js"),e},u=function(a){return r(a),s(a)},v=!1;console.debug=v?console.debug:b.noop;var w=function(a,d){var e,f=b.trimStart(a,"/");e=d?new WebSocket("ws://"+location.hostname+":"+d+"/"+f):new WebSocket("ws://"+location.host+"/"+f),e.onopen=function(a){console.debug("[watcher] websocket connection opened")},e.onmessage=function(a){if(b.startsWith(a.data,"data:")){var d=a.data.split(":"),e=c(d,3),f=(e[0],e[1]),g=e[2];console.debug("type = "+f+", filePath = "+g);var h=t(g);"changed"===f?n(g):"added"===f?s(h):"deleted"===f&&r(h)}else console.debug(a.data)},e.onclose=function(){console.debug("[watcher] websocket connection closed.")}};a["default"]=w,Object.defineProperty(a,"__esModule",{value:!0})});